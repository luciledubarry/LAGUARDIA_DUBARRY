---
title: "Data Management Project: Location and theme impact on museum attendance"
author: Joséphine Laguardia and Lucile Dubarry
format: 
  wordcount-html: default
code-fold: true
echo: false
---

```{r}
#| message: false
here::i_am("LAGUARDIA_DUBARRY.Rproj")
library(ggplot2)
library(dplyr)
library(tidyr)
library(vroom)
library(here)
library(stringr)
library(scales)
```

```{r loading}
#| message: false
museum <- vroom(here("musees-de-france-base-museofile.csv"))
freq <- vroom(here("frequentation-des-musees-de-france.csv"))
```

# Research question

The selection of the research topic on museum attendance in France stems from an interest in understanding the current landscape of museums in the country. Exploring the dynamics of museum attendance is crucial for gaining insights into the factors influencing visitor numbers. The central question revolves around the present state of museums in France and the key characteristics that impact their attendance.

We want to put into perspective the link between museums' attendance and museums' characteristics, whether it be their location or their category (history, art, etc...). The main question that we ask ourselves is : What is the impact of location on museums' attendance ? More precisely, how much being located in a big city affects attendance numbers ? And to add to it, does a link exist between attendance numbers and the category of the museum ?

We will try to answer these questions in this project, by first portraying the main characteristics of museums: their geographical distribution, their themes and their state of historical preservation. We'll show how museums are spread across the regions in France, and whether or not they're located in a major city, and in Paris or not. We will relate these characteristics to museum attendance figures for 2019. Finally, based on our findings, we will apply linear regression to study the impact of museum location and theme on attendance records. 

# Data sets description

## Sources

Both our data sets come from the **French Ministry of culture**. Since 2011, the Ministry of culture has set up both a public data census service and a data sharing service, open to all citizens, researchers, students, journalists, and companies. Its aim is to improve the exposure of cultural works and French cultural institutions. Even though it is a legal obligation since 2018 for administrations to open up their data, there are a lot of benefits from sharing these data: full transparency with the citizens, support for social innovations, boosting the local economy through discovering local cultural institutions, boosting France international influence etc.

Our first data set, **"Musées de France: base Muséofile"**, features all the museums that have been given the "Musée de France" label by the *Code du Patrimoine*. A "Musée de France" is, in accordance with the *Code du Patrimoine*, a "permanent collection made up of items whose conservation and presentation are of public interest, and organized for the knowledge, education and enjoyment of the public". As we'll see later, it contains basic information on these museums (such as the address, the website or the year of creation), as well as interesting complementary characteristics (such as the main theme of the museum, its most important asset or the leading artist of its permanent collection).

Our second data set, **"Fréquentation des musées de France"**, contains the number of visitors each year, from 2001 to 2021.

The advantage of gathering databases from the same website and the same institution of origin is that the merging will be a lot easier, due to the fact that they have variables in common. What's more, the source being the Ministry of culture gives us the assurance that the data has been collected correctly.

## Size

```{r}
info_museum <- museum |>
  summarise(
    data_base = "Museum data base",
    rows = NROW(museum),
    columns = NCOL(museum))
info_freq <- freq |>
  summarise(
    data_base = "Attendance data base",
    rows = NROW(freq), 
    columns = NCOL(freq))

infos <- rbind(info_museum,info_freq)

knitr::kable(infos, format = "html",col.names = c("Data base", "Number of rows","Number of columns"))
```

```{r}
NA_total <- freq |> filter(is.na(total)) |> nrow()
NA_dompal <- museum |> filter(is.na(dompal)) |> nrow()
```

We indicate below the number of NA in the key variables of our analysis:
- in the attendance data base: we do not have the attendance record of`r NA_total` museums, which will not be counted when analyzing the frequentation records. 
- in the museum data base: `r NA_dompal` museums do not indicate their themes, then we will not take these museums  into account when studying the museum themes. 
These missing variables are however in the minority in the final data base (on `r nrow(data)` museums) and will not affect the results for our analysis.

## Variables

### 1st data set - Musée de France: base Muséofile:

REF : Muséofile reference code;

NOMOFF : Official name of the museum;

AUTNOM : Customary name of the museum;

ADRL1_M : Address;

LIEU_M : Specifications of the address;

CP_M : Postal code;

VILLE_M : City;

DPT : Department;

REGION : Region;

URL_M : Website or page address;

TEL_M : Phone number of the museum;

CATEG: Specific museum category;

DOMPAL: Main themes of the collections;

HIST: History of the collection;

ATOUT: Assets of the collection;

THEMES: Details of the themes of the collections;

ARTIST: Leading artists of the collection;

PHARE: Leading personalities of the collection;

INTERET: Architectural feature of the building;

PROT-BAT: Type of building preservation;

PROT-ESP: Type of space preservation;

REFMER: Reference code in the Mérimée database;

AN-CREAT: Year of creation;

DMAJ: Date of the last information update; Latitude; Longitude.

### 2nd data set - Fréquentation des musées de France:

REF_MUSEE: Museum reference code;

NOM_DU_MUSEE: Museum official name;

ANNEE: Year of update;

REGIONS: Region;

VILLE: City;

DATE_APPELLATION: Date on which controlled museums receive the designation "Musées de France", since February 2003

PAYANT: Number of visits with paid entrance ticket;

GRATUIT: Number of visits with free entrance ticket;

TOTAL: Total of number of visits (PAYANT + GRATUIT);

NOTE: indicates:

-   "F": the museum is closed;

-   "NC": no frequentation data have been provided;

-   "R": withdrawal of the "Musées de France" designation.

ID_MUSEOFILE: Muséofile reference code ;

NOMDEP: Department;

OBSERVATIONS: The "OBSERVATIONS" column contains the references of the museums whose frequentation is aggregated.

# Data analysis

## Descriptive statistics

```{r merging and cleaning}
freq <- freq |> filter(annee == 2019)
freq <- freq |> filter(is.na(note))
freq <- freq |> select(id_museofile, nom_du_musee, regions, ville, total, payant, gratuit, nomdep)
museum <- museum |> select(ref, dompal, prot_bat, prot_esp, latitude, longitude)
museum <- museum |> rename(id_museofile = ref)
data <- inner_join(freq, museum, by = 'id_museofile')
```

### Geographical distribution

In this sub-section, we want to represent visually the cultural vitality of France and its regions.

First, let's take a look into the number of museums in each region, and the corresponding percentage in regards to the whole country.

```{r}
#| message : false
vitality1 <- summarise(data |>
            group_by(regions),
            number = n(), 
            percentage = round(100*n()/1016,1))
knitr::kable(vitality1,
            col.names = c("Regions","Number of museums","Percentage of museums"))
```

Multiple points are to be made here. With no surprise, "Île-de-France" is the most dynamic in terms of cultural vitality, with `r vitality1[10,2]` museums, corresponding to `r vitality1[10,3]` % of French museums. Paris being the capital of France, and the most visited city in the world, with more than 30 millions visitors per year, this result is understandable. To add another expected result, the biggest regions (in terms of surface area) are also very dynamic: Auvergne-Rhone-Alpes, Grand Est and Occitanie have the largest number of museums after Île-de-France. What is more surprising is Nouvelle-Aquitaine: it is the biggest region in France, and only includes around `r vitality1[14,3]` % of total museums in France.

Then, let's do the same process but in regards to the cumulative number of visits in each region, and the corresponding percentage.

```{r}
total_visits <- sum(data$total, na.rm = TRUE)

vitality2 <- summarise(data |>
            group_by(regions),
            cumulative = sum(total, na.rm = TRUE), 
            percentage2 = round(100*cumulative/total_visits,1)) |>
  mutate(cumulative = scales::comma(cumulative))

knitr::kable(vitality2,
            col.names = c("Regions","Number of visits","Percentage"))
```

This table shows us the cultural power of the "Île-de-France" region. With only `r vitality1[10,3]` % of total french museums, this region captures almost 60% of total visitors in France. The region completely crushes the others' percentages. Nevertheless, we find again the biggest regions : Auvergne-Rhones-Alpes (`r vitality2[1,3]` %), Provence-Alpes-Côte d'Azur (`r vitality2[17,3]` %), Grand Est (`r vitality2[6,3]` %), and Occitanie (`r vitality2[15,3]` %).

In order to compare the share of museums and the share of visitors a bit better, here is a graph showing them side by side, where we can se that the comparison between share of museums and share of visitors is outstandingly noticeable for Île-de-France.

```{r}
# we merge our two data frames
vit <- merge(vitality1,vitality2)
vit <- select(vit, - number, - cumulative)
# we rename the variables (for future aesthetic uses)
vit <- rename(vit, "% of total museums" = "percentage", "% of total visits" = "percentage2")
# we pivot longer (to represent both variables in a grouped way)
vit_long <- pivot_longer(vit, cols = c("% of total museums","% of total visits"), names_to = "Percentages")
# graph
gg <- ggplot(vit_long, aes(x= regions, y= value, fill = Percentages)) +
  geom_col(position = "dodge") +
  xlab("Regions") +
  ylab("Cultural vitality") +
  theme(axis.title = element_text(size = 13,
                                  color = "purple",
                                  face = "bold")) +
  scale_fill_hue(h = c(180, 270))
gg + coord_flip()
```

To go even further, we wanted to represent this cultural vitality on a map of France (because why not ?).

```{r}
#| message: false
# the packages we need 
library(sf)
library(tmap)
library(rmapshaper)
```

In order to do this, we had to introduce a new data base. This data base comes from the same source as our main bases, and includes French administrative boundaries at regional level (regional contours) from OpenStreetMap. The *Contours des régions françaises sur OpenStreetMap* dataset is available [here](https://www.data.gouv.fr/fr/datasets/contours-des-regions-francaises-sur-openstreetmap/#_).

```{r}
# we introduce a new data base 
regions <- read_sf("regions-20180101-shp/")
```

```{r}
#| message: false
# merging the data bases
vitality <- merge(vitality1,vitality2)
# ordering in alphabetical order (so that each data base has the same order)
regions <- regions[order(regions$nom),,]
vitality <- vitality[order(vitality$regions),,]
# deleting the rows that weren't common to both data base
regions <- filter(regions, nom != "Mayotte")
vitality <- filter(vitality, regions != "ST PIERRE ET MIQUELON")
# creating an index (to facilitate the joining)
id <- as.character(1:17)
regions <- cbind(regions, id)
vitality <- cbind(vitality, id)
# joining the data bases 
regions_vitality <- full_join(regions,vitality, by = "id")
```

Here it is:

```{r}
#| message: false
# rename the variable (for future aesthetic purposes)
regions_vitality <- rename(regions_vitality, "Name of the region" = "nom")

regions1 <- ms_simplify(regions_vitality)
plot <- ggplot(regions1)+
  geom_sf(aes(fill= `Name of the region`))+
  coord_sf(xlim = c(-5.5,10),ylim=c(41,51))+
  theme_void() +
  geom_sf_label(aes(label = number))
plot + labs(title = "Cultural vitality in France", subtitle = "Number of museums in each french region")
```

Unfortunately, we were unable to represent the French overseas regions on this map.

### City or not: Number of museums and frequentation records by city location

We now aim to assess how the distribution of museums, both in terms of number of museums and attendance, varies when they are located in densely populated cities. Does being located in large cities have a strong impact on museum attendance?

To find out, we separate museums into two categories, selecting the 10 largest cities in France: Paris, Marseille, Lyon, Toulouse, Nice, Nantes, Montpellier, Strasbourg, Bordeaux and Lille. We create the variable "city", worth 1 if the museum is located in 1 of these cities, 0 otherwise.

```{r}
city <- function(ville) {
    if (grepl("PARIS|LYON|MARSEILLE|TOULOUSE|NICE|NANTES|MONTPELLIER|STRASBOURG|BORDEAUX|LILLE", ville, ignore.case = TRUE)) {
    return("1")
  } else {
    return("0")
  }
}

data$city <- sapply(data$ville, city)
```

```{r}
data |>
  group_by(city) |>
  summarise(total_museum = n()) |>
  ggplot(aes(x = city, y = total_museum)) +
  geom_bar(stat = "identity", fill = "darkorchid3") +
  labs(title = "Number of museums by city location",
       x = "Location of the museum",
       y = "Number of museums") +
  scale_x_discrete(labels = c("other location", "city location"))
```

```{r}
perc5 <- data |>
  filter(city == "0") |>
  summarize(n = n()) |>
  mutate(percentage = n / nrow(data) * 100) |>
  mutate(percentage = round(percentage, 2))

perc6 <- data |>
  filter(city == "1") |>
  summarize(n = n()) |>
  mutate(percentage = n / nrow(data) * 100) |>
  mutate(percentage = round(percentage, 2))
```

In terms of the number of museums, the most populated cities do not account for a disproportionate number of museums in France, and `r perc5$percentage`% of museums are located outside major cities.

```{r}
data |> filter(!is.na(total)) |>
  group_by(city) |>
  summarise(total_freq = sum(total)) |>
  ggplot(aes(x = city, y = total_freq)) +
  geom_bar(stat = "identity", fill = "darkorchid3") +
  labs(title = "Frequentation of museums by city location",
       x = "Location of the museum",
       y = "Cumulative frequentation") +
  scale_y_continuous(labels = scales::comma)+
  scale_x_discrete(labels = c("other location", "city location"))
```

```{r}
freq_total <- data |> filter(!is.na(total)) |> summarize(freq_total = sum(total))

perc7 <- data |>
  filter(!is.na(total)) |>
  filter(city == "1") |>
  summarize(total_freq = sum(total)) |>
  mutate(percentage = total_freq / freq_total * 100) |>
  mutate(percentage = round(percentage, 2))
```

Although only `r perc6$percentage`% of museums are located in France's largest centers, these cities have an important drawing power. The cumulative attendance record of these 10 cities exceeds that of all other French museums combined, with almost 35 million visitors in 2019, representing `r perc7$percentage`% of total attendance this year.

### Capital or not: Number of museums and frequentation records in Paris

We can narrow our focus and observe whether being located in Paris has a significant impact on the number of museums and their attendance figures.

We repeat the same operation than in the previous section for the capital. We create the variable "PARIS" such that it is equals to 1 is the museum is located in the capital, 0 otherwise.

```{r}
PARIS <- function(ville) {
    if (grepl("PARIS", ville, ignore.case = TRUE)) {
    return("1")
  } else {
    return("0")
  }
}

data$PARIS <- sapply(data$ville, PARIS)
```

```{r}
data |>
  group_by(PARIS) |>
  summarise(total_museum = n()) |>
  ggplot(aes(x = PARIS, y = total_museum)) +
  geom_bar(stat = "identity", fill = "darkgreen") +
  labs(title = "Comparison of the number of museums in Paris and other location ",
       x = "Location of the museum",
       y = "Number of museums") +
  scale_x_discrete(labels = c("other location", "located in Paris"))
```

```{r}
perc8 <- data |>
  filter(PARIS == "1") |>
  summarize(n = n()) |>
  mutate(percentage = n / nrow(data) * 100) |>
  mutate(percentage = round(percentage, 2))
```

In terms of the number of museums, the capital does not seem to have a major impact on museum location. With only `r perc8$n` museums located in Paris, it represents `r perc8$percentage`% of the total French museums.

```{r}
data |> filter(!is.na(total)) |>
  group_by(PARIS) |>
  summarise(total_freq = sum(total)) |>
  ggplot(aes(x = PARIS, y = total_freq)) +
  geom_bar(stat = "identity", fill = "darkgreen") +
  labs(title = "Frequentation of museums located in Paris and other location",
       x = "Location of the museum",
       y = "Cumulative frequentation") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_discrete(labels = c("other location", "located in Paris"))
```

```{r}
perc9 <- data |>
  filter(!is.na(total)) |>
  filter(PARIS == "1") |>
  summarize(total_freq = sum(total)) |>
  mutate(percentage = total_freq / freq_total * 100) |>
  mutate(percentage = round(percentage, 2))
```

However, the result is not the same as regards the attendance record. With just `r perc8$n` museums located in Paris, the capital managed to attract almost 30 million of visitors in 2019, equivalent to `r perc9$percentage`% of this year's total attendance.

### Second characteristic of the museums: their themes

**Regroup museum theme into main categories**

To facilitate the analysis, we decided to recategorize the variable dompal, so as to classify the museums into three categories that seem to us to be particularly distinct from each other, and which well characterize the type of museum: Art, History and Science. We construct the classification in such a way that museums can have several categories.

The Art category includes themes such as Beaux-arts, Art moderne, Arts décoratifs, etc. The History category consists of Histoire, Archéologie, Ethnologie, etc. Finally, the Science category is composed of Technique et industrie, Sciences fondamentales and Sciences de la nature.

```{r}
category <- function(dompal) {
  categories <- character()

  if (grepl("Ethnologie|Archéologie|Histoire|esclavage", dompal, ignore.case = TRUE)) {
    categories <- c(categories, "History")
  }
  if (grepl("Art moderne et contemporain|Beaux-Arts|Arts décoratifs|Littérature|Musique|Photographie|Arts de l'Islam|Mode et textile|musique", dompal, ignore.case = TRUE)) {
    categories <- c(categories, "Art")
  }
  if (grepl("Sciences de la nature|Technique et industrie|Sciences fondamentales", dompal, ignore.case = TRUE)) {
    categories <- c(categories, "Science")
  }

  if (length(categories) == 0) {
    return(dompal)
  } else {
    return(paste(categories, collapse = ", "))
  }
}

data$category <- sapply(data$dompal, category)
```

```{r}
NA_count <- data |> filter(is.na(category))
```

`r count(NA_count)|>pull(n)` museums does not indicate a specific theme, then they will not be taken into account in the following representations.

**Diversity of museum theme at the national scale**

We study the diversity of museum subjects in France, by representing the distribution of the number of museums in each categories.

We first study museum theme as a combination of categories (a museum type is composed between one and three categories), then we consider categories individually to determine the most frequent museum type in France.

The following graph show the number of museums by category, keeping the categories as a group.

```{r}
data |> filter(!is.na(category)) |> ggplot(aes(x = category)) +
  geom_bar(fill = "darkgreen") +
  labs(title = "Distribution of museum theme at the national scale",
       x = "Categories",
       y = "Number of museums") +
  coord_flip()
```

```{r}
perc1 <- data |>
  filter(category == "History, Art") |>
  summarize(n = n()) |>
  mutate(percentage = n / nrow(data) * 100) |>
  mutate(percentage = round(percentage, 2))
```

The most frequent group of museum categories in France is History and Art. With `r perc1$n` museums in this category, it represents `r perc1$percentage`% of the total number of museums in France.

To determine the most frequent museum type, we will represent the number of museums in each category by considering the categories individually. In the following section, we have made the significant choice of considering that, since some museums have several different categories, they will be counted in each category in which they appear.

```{r}
library(stringr)
data_expanded <- data |> filter(!is.na(category)) |>
  mutate(category = str_split(category, ", ")) |>
  unnest(category)

category_count <- data_expanded |>
  group_by(category) |>
  summarise(total_museums = n())

ggplot(category_count, aes(x = category, y = total_museums, fill = category)) +
  geom_bar(stat = "identity") +
  labs(title = "Distribution of museum theme (considering categories individually)",
       x = "Categories",
       y = "Number of museums") +
  scale_fill_brewer(palette="Greens")
```

The following table shows the percentage of museums that include the category in their description, relative to the total number of museums in France.

```{r}
category_count <- category_count |> 
  mutate(perc = total_museums/nrow(data)*100) |>
  mutate(perc = scales::percent(perc, scale = 1))

knitr::kable(category_count, col.names = c("Category","Number of museums","Proportion of museums indicating this category"))
```

We read the result as, for example, `r category_count[1,3]` of museums in France indicate the Art category (possibly among other categories). With `r category_count[2,3]` of the museums indicating History in their description, this is the most common type of museum in France, in terms of number of museums.

Therefore, the most frequent category, when considering the categories individually is History, followed by Art. There is also a significant drop for Science museums, compared to the two other categories. However, we should keep in mind when analyzing the results that categories are often linked to each others, particularly History and Art.

**Representation of museum themes at the regional level**

```{r}
region_count <- data_expanded |> 
  select(regions, category) |> 
  filter(!is.na(category)) |>
  group_by(regions, category) |>
  summarise(total_museums = n(), .groups = "drop")

ggplot(region_count, aes(x = regions, y = total_museums, fill = category)) +
  geom_col(position = "dodge") +
  labs(title = "Distribution of museum theme at the regional level",
       x = "Regions",
       y = "Number of museums") +
  theme(axis.title = element_text(size = 13,
                                  color = "purple",
                                  face = "bold")) +
  scale_fill_hue(h = c(180, 270)) +
  coord_flip()
```

All regions, with the exception of Île-de-France, have a similar distribution of museum themes (when considering categories individually): the most common type of museum is History, more or less followed by Art, and in third place Science museums. Île-de-France is the only region where the number of Art museums (mentioning Art among other categories) exceeds that of History museums.

**Attendance records depending on the museum type**

We now focus on the attendance records depending on the type of museums, by representing the total frequentation for each categories.

In the same way as in the previous section, we separate our analysis by studying the museum theme as a combination of categories and by considering the categories individually.

```{r}
data |> filter(!is.na(total)) |> filter(!is.na(category)) |>
  group_by(category) |>
  ggplot(aes(x = category, y = total)) +
  geom_bar(stat="identity", fill = "darkgreen") +
  labs(title = "Frequentation at the national level depending on types",
       x = "Categories",
       y = "Number of museums") +
  coord_flip() +
  scale_y_continuous(labels = scales::comma)
```

```{r}
perc2 <- data |>
  filter(!is.na(total)) |>
  filter(category == "History, Art") |>
  summarize(total = sum(total)) |>
  mutate(percentage = total/freq_total * 100) |>
  mutate(total = scales::comma(total)) |>
  mutate(percentage = round(percentage, 2))
```

Visitors is not an evenly distributed asset! One category of museum (History and Art) is significantly ahead of the others in terms of attendance records, with `r perc2$total` visitors in 2019 which represents `r perc2$percentage`% of the total frequentation.

```{r}
perc3 <- data |>
  filter(category == "History") |>
  summarize(n = n())

perc4 <- data |>
  filter(!is.na(total)) |>
  filter(category == "History") |>
  summarize(total = sum(total)) |>
  mutate(total = scales::comma(total))
```

Although this category is the most widespread in France, with `r perc1$n` museums classified as History and Art, this attendance record is particularly high, compared with those of other categories. The other most common categories do not achieve the same attendance figures. The category History shows a major difference between the number of museums and the frequentation track: `r perc3` museums are listed as being exclusively of the History type (representing the third most frequent museum type), but its frequentation record is in fourth place, with `r perc4` visitors in 2019.

```{r}
freq_count <- data_expanded |>
  filter(!is.na(total)) |>
  group_by(category) |>
  summarise(freq_category = sum(total))

ggplot(freq_count, aes(x = category, y = freq_category, fill = category)) +
  geom_bar(stat = "identity") +
  labs(title = "Frequentation of museums (considering categories individually)",
       x = "Categories",
       y = "Total frequentation") +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_brewer(palette="Greens")
```

```{r}
freq_count <- freq_count |> 
  mutate(perc = freq_category/65623724*100) |>
  mutate(freq_category = scales::comma(freq_category)) |>
  mutate(perc = scales::percent(perc, scale = 1))

knitr::kable(freq_count, col.names = c("Category","Total frequentation","Proportion of frequentation for each category"))
```

Looking at the categories individually, we observe that Art museums leads the way in terms of attendance record, with `r freq_count[1,3]` of the visits in 2019 to museums featuring Art in their description. Although Art museums are not the most common type of museum in France (behind History museums), total attendance for this type exceeds that of History museums in 2019. Visitor numbers for History museums remain close, with `r freq_count[2,3]` of visits to museums classified as History.

It should be noted that frequentation between these two categories is highly interrelated, as museums categorized as both History and Art being the most prominent in France, both in terms of numbers of museums and attendance.

We also notice a significant difference between the total attendance of Science museums and that of the other two categories, with only `r freq_count[3,3]` of visits concerning museums classified as Science.

We can therefore conclude that the most popular museum theme in France is Art, followed very closely by History, a result largely due to the high attendance rates of museums classified in both the History and Art categories.

### Third charasteristic: Building and Space preservation

In this section, we will comment on the number of museums that are concerned by building preservation and space preservation. The variables "prot_bat" and "prot_esp" respectively indicates if the museum is listed as a protected historical monument and as a remarkable cultural site (or located close to a protected historical monument).

```{r}
data <- data |>
  mutate(building_preservation = ifelse(!is.na(prot_bat) & startsWith(prot_bat, "Protégé"), "Protected", "Not Protected"))

ggplot(data, aes(x = building_preservation)) +
  geom_bar(fill = "cornflowerblue") +
  labs(title = "Number of museums under building preservation",
       x = "Building preservation status",
       y = "Number of museums")
```

```{r}
data <- data |>
  mutate(space_preservation = ifelse(!is.na(prot_esp), "Protected", "Not Protected"))

ggplot(data, aes(x = space_preservation)) +
  geom_bar(fill = "cornflowerblue") +
  labs(title = "Number of museums under space preservation",
       x = "Space preservation status",
       y = "Number of museums")
```

```{r}
perc10 <- data |>
  filter(building_preservation == "Protected") |>
  summarize(n = n()) |>
  mutate(percentage = n / nrow(data) * 100) |>
  mutate(percentage = round(percentage, 2))

perc11 <- data |>
  filter(space_preservation == "Protected") |>
  summarize(n = n()) |>
  mutate(percentage = n / nrow(data) * 100) |>
  mutate(percentage = round(percentage, 2))
```

Historical preservation status, both of the building and the space around the museum, concerns a large proportion of French museums. `r perc10$n` museums are listed as a historical monument, which represents `r perc10$percentage`% of all museums. The number is even greater when it comes to space preservation, since `r perc10$percentage`% of the museums are classified as a preserved space (or located near a protected monument).

Our findings on the geographical distribution of museums in France highlight the crucial impact of location on museum attendance. More than any other characteristic we studied, location seems to be the key to high frequentation rates. Although a minority of museums are located in France's 10 largest cities, these museums attracted over 50% of total visitors in 2019. The results are even more striking if we compare museums located in Paris with all other museums in France, with `r perc9$pourcentage`% of this year's total attendance in Parisian museums.

## Impact of location on attendance

Knowing what we now discovered, multiple questions can be asked. First, what is the impact of location on museums' attendance ? What we mean by location is two possible variables : the museum being located in one of the 10 biggest cities (or not) and the museum being located in Paris (or not). Let's study the first case.

### The impact of being located in one of the 10 biggest cities on museums' attendance

The relation that we are looking for between attendance and location is of this form:

Attendance = b0 + b1\*City

Since the variable *city* is a dummy variable, we interpret the coefficients b0 and b1 such as : b0 is the average number of visitors for a museum not located in one of the 10 biggest cities, and b1 is the number of visitors that are added to b0, corresponding to the average number of visitors in a museum located in a big city. 
We find the following relationship:

```{r first regression}
first_regression <- lm(total ~ city, data = data)
summary(first_regression)
```

From this regression, we can say that the average number of visitors per year for a museum not located in one of the 10 biggest cities is estimated to be 34856. For a museum located in one of those cities, on the other hand, it is estimated to be 34856 + 260451, which is equal to: 295 307 visitors. This means that the sole fact of being located in a big city multiplies the number of visitors by more than 8. 

```{r}
plot(data$city, data$total, main = "Link between being located in a big city and museums attendance", xlab = "Located in one of the 10 biggest cities", ylab = "Total visits in a year", xaxt = "n", ylim = c(0, 700000))
abline(first_regression, col = "red")
axis(1, at = 0:1)
```

In conclusion, the fact that a museum is located in a big city has a significant positive impact on its attendance. This can be explained by the fact that those cities are densely populated, meaning that more people from the city have the occasion to go to those museums. Furthermore, those cities attract tourists, which can enjoy the cultural aspect of the city they're visiting through going to the museum. 

### The impact of being located in Paris on museums' attendance

Let's focus now on one city in particular: Paris.The relation that we are looking for is of this form:

Attendance = b0 + b1\*Paris

The variable *paris* being a dummy variable as well, we interpret the coefficients b0 and b1 just like before.
We find the following relationship:

```{r second regression}
second_regression <- lm(total ~ PARIS, data = data)
summary(second_regression)
```

From this regression, we can say that the average number of visitors per year for a museum not located in Paris is estimated to be 39521. For a museum located in Paris, on the other hand, it is estimated to be 39521 + 501212, which is equal to: 540 733 visitors. This means that the only fact of being located in Paris multiplies the attendance numbers by more than 13 ! 

```{r}
plot(data$city, data$total, main = "Link between being located in Paris and museums attendance", xlab = "Located in Paris", ylab = "Total visits", xaxt = "n",ylim = c(0, 700000))
abline(second_regression, col = "blue")
axis(1, at = 0:1)
```

Therefore, the impact of being located in Paris is significantly beneficial for a museum, in terms of number of visitors. The positive effect is not surprising, with Paris being the most visited city in the world. But the intensity of it is impressive. 

## Impact of a museum's theme on attendance

Our second focus for this analysis is the museum's theme: Does its theme have an impact on its attendance ? Let's look into it.

```{r new variables }
# creating a dummy variable for the category history
art <- function(category) {
    if (grepl("Art", category, ignore.case = TRUE)) {
    return("1")
  } else {
    return("0")
  }
}

data$art <- sapply(data$category, art)

# creating a dummy variable for the category history
history <- function(category) {
    if (grepl("History", category, ignore.case = TRUE)) {
    return("1")
  } else {
    return("0")
  }
}

data$history <- sapply(data$category, history)

# creating a dummy variable for the category science
science <- function(category) {
    if (grepl("Science", category, ignore.case = TRUE)) {
    return("1")
  } else {
    return("0")
  }
}

data$science <- sapply(data$category, science)
```

### The impact of being an Art museum on its attendance

```{r third regression}
third_regression <- lm(total ~ art, data = data)
summary(third_regression)
```

This regression indicates us that a scrictly history or science museum (meaning that it is not categorized as Art in any way, even cumulated with History or Science) has an estimated average number of visitors equal to 34 930. A museum categorized as an Art museum has on average 47 830 more visitors, which means that the only fact of being an Art museum doubles the attendance. 

### The impact of being a History museum on its attendance

```{r fourth regression}
fourth_regression <- lm(total ~ history, data = data)
summary(fourth_regression)
```

The same way, a History museum has, on average, 6 481 more visitors than the other kinds of museums. This corresponds to an increase of 10%. 

### The impact of being a Science museum on its attendance

```{r fifth regression}
fifth_regression <- lm(total ~ science, data = data)
summary(fifth_regression)
```

For science museums, the effect is opposite: the only fact of being a Science museum decreases their attendance by 35%.

```{r plots 1}
par(mfrow = c(1,3))
# plot 1
plot(data$art, data$total, main = "Impact of being an \nart museum on its attendance", xlab = "Being an art museum", ylab = "Total visits", xaxt = "n", ylim = c(0, 500000))
abline(third_regression, col = "darkgreen")
axis(1, at = 0:1)
# plot 2
plot(data$history, data$total, main = "Impact of being a \nhistory museum on its attendance", xlab = "Being a history museum", ylab = "Total visits", xaxt = "n",ylim = c(0, 500000))
abline(fourth_regression, col = "pink")
axis(1, at = 0:1)
# plot 3
plot(data$science, data$total, main = "Impact of being a \nscience museum on its attendance", xlab = "Being a science museum", ylab = "Total visits", xaxt = "n",ylim = c(0, 500000))
abline(fifth_regression, col = "orange")
axis(1, at = 0:1)
```

In conclusion, being an art museum has a strong positive impact on attendance, while being a science museum has a strong negative impact. The theme being history has a weak positive impact on attendance. 

## Adding control variables

Another question that could be asked is the impact of the museum's theme on the pre-existing relation between location and attendance. Is the impact of being located in a big city stronger if the museum is an Art museum ? Let's look into it.

### Link between being located in a big city and attendance, art theme

```{r sixth regression}
sixth_regression <- lm(total ~ city + art, data = data)
summary(sixth_regression)
```

This regression indicates that a museum not located in a big city and not categorized as an Art museum has an estimated average number of visitors equal to 10 626. If a museum is located in a big city but still is not categorized as Art museum, its number of visitor is multiplied by 25 (from 10 626 visitors to 267 964 visitors). Lastly, if the museum is located in a big city and is an Art museum, then its number of visitors increases by 15% compared to a non-art museum in a big city. 

### Link between being located in a big city and attendance, history theme

```{r seventh regression}
seventh_regression <- lm(total ~ city + history, data = data)
summary(seventh_regression)
```

This regression tells us that a non-history museum located in a small city has an estimated average number of visitors equal to 509 (which seems very little, but we have to keep in mind that History is the most present category). If a museum is located in a big city but is not a History museum, then its attendance is multiplied by more than 530 (from 509 visitors to 270 621) ! Furthermore, if it is a history museum, its attendance increases by 15%.

### Link between being located in a big city and attendance, science theme

```{r eighth regression}
eighth_regression <- lm(total ~ city + science, data = data)
summary(eighth_regression)
```

Finally, from this last regression, we learn that the average estimated number of visitors in a non-science museum located in a small city is equal to 39 630. If the museum is located in a big city, but is still not a science museum, then its attendance is multiplied by 7 (from 39 630 to 298 653). Lastly, if it is a science museum, then its attendance decreases, even if it is located in a big city, by 5%. 

In conclusion, the theme of the museum has in fact an impact on the pre-existing relationship between location and attendance. More precisely, history and art increases the attendance in a big city while science decreases it slightly. 

Our results from our causal analysis indicates a link between attendance and museums' characteristics such as location and theme. We recall that being located in a big city multiplies the attendance by 8, while being located in Paris multiplies it by more than 13. The location has thus a critical impact on museums' number of visitors. With respect to the theme of the museums, Art and History have a positive effect on attendance, while science has a significant negative impact.

# Conclusion

What is the impact of location on museums' attendance ? Our observations in the first section and the calculations we have carried out point in the same direction for understanding the relationship. More than any other characteristic we studied, we can conclude that the most critical impact on museum attendance is unquestionably its location.

The results of our regression when we consider being in one of France's 10 largest cities show a significant positive impact on museum attendance. And the difference in attendance is even more marked when the museum is located in Paris. The positive effect is not surprising considering the capital's power of cultural attraction, both nationally and internationally, but its intensity is striking. Clearly, the game is not the same for museums located in the largest French cities as it is for all the others (and even more so for those located in Paris). The mere fact of being located in Paris multiplies attendance figures by more than 13! 

What about the link between attendance and museum category? Based on our regression describing the impact of being an art museum on its attendance, art is the theme to choose to attract visitors. The only fact of being an art museum doubles the attendance. The category history have weak positive impact on frequentation. These results are consistent with our findings on the cultural diversity of museum themes, since we found that museums classified as history and art are the most influential, both in terms of number of museums and attendance. It should be noted that the numbers in these two categories are strongly correlated, since museums combining in history and art themes are the most common and the most visited ones. 

Science museums, on the other hand, don't seem to be on a roll in terms of the current museum landscape in France (much to our disappointment). As regards the number of museums, they rank third ( this is true for all regions). In terms of attendance, there is a significant difference with the other two categories, with only `r freq_count[3,3]`% of visits to museums categorized in Science. The regression we made corresponds to this finding, since this theme is the only one to have a negative effect on the attendance rate. 

# Annex

## Link to our GitHub

We work on the Github project, available [here](https://github.com/luciledubarry/LAGUARDIA_DUBARRY.git).

## Link to sources

The **"Musées de France: base Muséofile"** dataset is available [here](https://www.data.gouv.fr/fr/datasets/musees-de-france-base-museofile/#/resources)

The **"Fréquentations des musées de France"** dataset is available [here](https://www.data.gouv.fr/fr/datasets/frequentation-des-musees-de-france-1/#/resources)

## Details of our data cleaning and joining 

The freq data set only includes Muséofile references starting from 2019. The years following 2019 are highly impacted by Covid crisis. We don't take into account these years in our study, as they are not representative of the museum's usual frequentation. We use the “filter” function and select only the year **2019** for the freq data base.

First, we get rid of museums that don't have the frequentation data, represented by the variable NOTE (when either the museum is closed or the information is partially completed). So, we only select the museums whose NOTE variable is empty. 

Then, we only keep the variables of interest, and drop the rest. The variables that we keep are:
**1st data set Frequentation:**
ID_MUSEOFILE; NOM_DU_MUSEE; REGIONS; VILLE; TOTAL; PAYANT; GRATUIT; NOMDEP
**2nd data set Muséofile:**
REF; DOMPAL; ARTISTE;PROT-ESP; PROT-BAT;LATITUDE;LONGITUDE

We join the data bases with reference to the **Muséofile ID number**. On the Museofile database it is the variable named REF and on the Frequentation database it is the variable named ID_MUSEOFILE.
We use the function "inner_join" as it allows us to keep only the museums for which we have all the information (the frequentation and the characteristics). 

